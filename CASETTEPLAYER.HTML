<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mood Tape</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Special+Elite&family=Lora:ital@0;1&display=swap" rel="stylesheet" />
<style>
:root{--bg:#f5efe6;--paper:#ede4d3;--ink:#2c1f0e;--muted:#8b7355;--accent:#c0392b;--cassette-face:#e8734a;}
*{margin:0;padding:0;box-sizing:border-box;}
body{
  background-color:var(--bg);
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  min-height:100vh;font-family:'Lora',Georgia,serif;color:var(--ink);
  display:flex;flex-direction:column;align-items:center;
  padding:36px 20px 80px;transition:background-color 1.2s ease;overflow-x:hidden;
}
header{text-align:center;margin-bottom:28px;}
.logo-line{font-family:'Special Elite',cursive;font-size:18px;margin-bottom:4px;line-height:1;}
h1{font-family:'Playfair Display',serif;font-size:clamp(2rem,5vw,3rem);font-weight:400;line-height:1.1;}
h1 em{font-style:italic;color:var(--accent);transition:color 1s;}
.tagline{font-family:'Lora',serif;font-style:italic;font-size:.9rem;color:var(--muted);margin-top:8px;}

.cassette-scene{position:relative;width:320px;margin:0 auto 10px;}
.cassette-wrap{
  position:relative;width:100%;
  filter:drop-shadow(0 16px 32px rgba(0,0,0,.24));
  transition:transform .6s cubic-bezier(.23,1,.32,1),filter .6s;
  transform-origin:center;
}
.cassette-wrap:not(.playing):hover{transform:translateY(-4px) rotate(-.8deg);}
.cassette-wrap.playing{animation:cassFloat 3.2s ease-in-out infinite;}
@keyframes cassFloat{
  0%,100%{transform:translateY(0) rotate(-.5deg);filter:drop-shadow(0 16px 32px rgba(0,0,0,.24));}
  50%{transform:translateY(-10px) rotate(.6deg);filter:drop-shadow(0 30px 52px rgba(0,0,0,.36));}
}
.cassette-svg{width:100%;height:auto;display:block;border-radius:6px;}
.cassette-face-overlay{
  position:absolute;top:10%;left:5%;width:90%;height:75%;border-radius:4px;
  background:var(--cassette-face);mix-blend-mode:multiply;opacity:.5;
  transition:background 1.2s,opacity .8s;pointer-events:none;
}
.cassette-wrap.playing .cassette-face-overlay{animation:glowPulse 2s ease-in-out infinite;}
@keyframes glowPulse{0%,100%{opacity:.38;}50%{opacity:.72;}}
.cassette-wrap.playing::after{
  content:'';position:absolute;inset:-10px;border-radius:10px;
  box-shadow:0 0 40px 10px color-mix(in srgb,var(--cassette-face) 50%,transparent);
  pointer-events:none;animation:ringPulse 2.4s ease-in-out infinite;
}
@keyframes ringPulse{0%,100%{opacity:.2;}50%{opacity:.9;}}
.cassette-label-area{position:absolute;top:13%;left:18%;width:64%;padding:5px 8px;text-align:center;}
.cassette-tape-title{font-family:'Special Elite',cursive;font-size:8px;letter-spacing:.1em;color:#3a2a1a;text-transform:uppercase;opacity:0;transition:opacity .6s;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.cassette-tape-title.visible{opacity:1;}
.reel-overlay{position:absolute;top:36%;width:62px;height:62px;border-radius:50%;pointer-events:none;}
.reel-left-pos{left:19%;transform:translateX(-50%);}
.reel-right-pos{right:19%;transform:translateX(50%);}
.reel-overlay svg{width:100%;height:100%;display:block;}
.reel-overlay.spinning svg{animation:reelSpin 1.6s linear infinite;}
@keyframes reelSpin{to{transform:rotate(360deg);}}
.wave-bars{
  position:absolute;bottom:14%;left:50%;transform:translateX(-50%);
  display:flex;gap:3px;align-items:flex-end;height:20px;
  opacity:0;transition:opacity .4s;
}
.wave-bars.visible{opacity:1;}
.wave-bar{width:3px;background:rgba(255,255,255,.8);border-radius:2px;height:4px;}
.wave-bars.active .wave-bar{animation:waveAnim .7s ease-in-out infinite alternate;}
.wave-bar:nth-child(1){animation-delay:0s;}.wave-bar:nth-child(2){animation-delay:.1s;}
.wave-bar:nth-child(3){animation-delay:.2s;}.wave-bar:nth-child(4){animation-delay:.12s;}
.wave-bar:nth-child(5){animation-delay:.05s;}.wave-bar:nth-child(6){animation-delay:.18s;}
.wave-bar:nth-child(7){animation-delay:.08s;}
@keyframes waveAnim{from{height:3px;}to{height:17px;}}

.player-section{width:100%;max-width:520px;margin-bottom:18px;}
.now-playing{text-align:center;margin-bottom:12px;font-family:'Playfair Display',serif;font-style:italic;font-size:.95rem;color:var(--ink);min-height:22px;}
.now-playing em{color:var(--accent);}
.progress-bar-wrap{height:3px;background:#d5c5ae;border-radius:2px;cursor:pointer;margin-bottom:14px;}
.progress-fill{height:100%;background:var(--accent);border-radius:2px;width:0%;transition:background 1s;}
.play-controls{display:flex;align-items:center;justify-content:center;gap:22px;}
.ctrl-btn{background:none;border:none;cursor:pointer;color:var(--muted);transition:color .2s,transform .15s;padding:6px;line-height:1;}
.ctrl-btn:hover{color:var(--ink);transform:scale(1.1);}
.ctrl-btn.play-pause{color:var(--ink);}
.ctrl-btn svg{display:block;}
.volume-wrap{display:flex;align-items:center;gap:8px;margin-top:11px;justify-content:center;}
.vol-icon{font-size:13px;color:var(--muted);}
.vol-slider{-webkit-appearance:none;width:120px;height:2px;background:#d5c5ae;border-radius:2px;outline:none;cursor:pointer;}
.vol-slider::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;border-radius:50%;background:var(--accent);cursor:pointer;}

.playlist-section{width:100%;max-width:520px;margin-bottom:20px;}
.section-label{font-family:'Special Elite',cursive;font-size:10px;letter-spacing:.3em;text-transform:uppercase;color:var(--muted);margin-bottom:12px;display:block;text-align:center;}
.tab-bar{display:flex;gap:0;margin-bottom:14px;border-bottom:1.5px solid #d5c5ae;flex-wrap:wrap;}
.tab-btn{
  font-family:'Special Elite',cursive;font-size:9px;letter-spacing:.18em;text-transform:uppercase;
  padding:8px 12px;background:none;border:none;cursor:pointer;color:var(--muted);
  transition:color .2s;border-bottom:2px solid transparent;margin-bottom:-1.5px;
}
.tab-btn:hover{color:var(--ink);}
.tab-btn.active{color:var(--accent);border-bottom-color:var(--accent);}
.tab-panel{display:none;}
.tab-panel.active{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.playlist-track{
  display:flex;align-items:center;gap:10px;padding:10px 12px;
  background:var(--paper);border:1.5px solid transparent;
  border-radius:2px;cursor:pointer;transition:all .2s;
}
.playlist-track:hover{border-color:rgba(0,0,0,.12);transform:translateY(-1px);}
.playlist-track.active{border-color:var(--accent);}
.track-emoji{font-size:17px;flex-shrink:0;}
.track-meta{min-width:0;}
.track-meta-title{font-family:'Lora',serif;font-size:.78rem;color:var(--ink);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.track-meta-artist{font-family:'Lora',serif;font-style:italic;font-size:.68rem;color:var(--muted);}
.playlist-track.active .track-emoji{animation:dotPulse 1s ease-in-out infinite;}
@keyframes dotPulse{0%,100%{transform:scale(1);}50%{transform:scale(1.35);}}


.calm-section{width:100%;max-width:520px;margin-bottom:22px;background:var(--paper);border:1px dashed #c4b49a;padding:18px 20px;}
.calm-header{display:flex;align-items:center;gap:10px;margin-bottom:12px;}
.calm-icon{font-size:22px;}
.calm-title{font-family:'Playfair Display',serif;font-size:1rem;font-style:italic;color:var(--ink);}
.calm-subtitle{font-family:'Special Elite',cursive;font-size:8px;letter-spacing:.2em;text-transform:uppercase;color:var(--muted);}
.calm-input-row{display:flex;gap:8px;margin-bottom:12px;}
.calm-input{flex:1;background:transparent;border:none;border-bottom:1px solid var(--muted);padding:8px 4px;font-family:'Lora',serif;font-size:.88rem;font-style:italic;color:var(--ink);outline:none;}
.calm-input::placeholder{color:#c4b49a;font-style:italic;}
.calm-btn{font-family:'Special Elite',cursive;font-size:9px;letter-spacing:.2em;text-transform:uppercase;padding:8px 14px;border:1px solid var(--ink);background:var(--ink);color:var(--bg);cursor:pointer;transition:all .2s;white-space:nowrap;}
.calm-btn:hover{background:var(--accent);border-color:var(--accent);}
.calm-response{font-family:'Lora',serif;font-size:.84rem;line-height:1.75;color:var(--ink);font-style:italic;min-height:18px;transition:opacity .4s;}
.calm-response.loading{opacity:.35;animation:pulse 1s infinite;}
@keyframes pulse{0%,100%{opacity:.25;}50%{opacity:.7;}}
.calm-tracks{margin-top:12px;display:flex;flex-wrap:wrap;gap:6px;}
.calm-track-pill{font-family:'Special Elite',cursive;font-size:8px;letter-spacing:.1em;text-transform:uppercase;padding:4px 10px;border:1px solid #c4b49a;background:transparent;color:var(--muted);cursor:pointer;transition:all .2s;border-radius:20px;}
.calm-track-pill:hover{border-color:var(--accent);color:var(--accent);}

.palette-section{width:100%;max-width:520px;margin-bottom:22px;}
.palette-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;}
.palette-swatch{display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer;}
.swatch-preview{width:100%;aspect-ratio:1;border-radius:50%;border:2px solid transparent;position:relative;overflow:hidden;transition:transform .2s,border-color .2s,box-shadow .2s;}
.swatch-preview::before,.swatch-preview::after{content:'';position:absolute;left:0;right:0;height:50%;}
.swatch-preview::before{top:0;background:var(--sw-face);}
.swatch-preview::after{bottom:0;background:var(--sw-accent);}
.palette-swatch:hover .swatch-preview{transform:scale(1.12);box-shadow:0 4px 14px rgba(0,0,0,.18);}
.palette-swatch.active .swatch-preview{border-color:var(--ink);transform:scale(1.12);}
.swatch-name{font-family:'Special Elite',cursive;font-size:8px;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);text-align:center;}
.palette-swatch.active .swatch-name{color:var(--ink);}

.input-section{width:100%;max-width:520px;margin-bottom:20px;}
.input-label{font-family:'Special Elite',cursive;font-size:10px;letter-spacing:.3em;text-transform:uppercase;color:var(--muted);margin-bottom:10px;display:block;}
.mood-input{width:100%;background:transparent;border:none;border-bottom:1.5px solid var(--muted);padding:12px 4px;font-family:'Playfair Display',serif;font-size:1.1rem;font-style:italic;color:var(--ink);outline:none;transition:border-color .3s;caret-color:var(--accent);}
.mood-input::placeholder{color:#c4b49a;font-style:italic;}
.mood-input:focus{border-bottom-color:var(--accent);}
.actions{display:flex;gap:10px;margin-top:16px;flex-wrap:wrap;justify-content:center;}
.btn{font-family:'Special Elite',cursive;font-size:10px;letter-spacing:.22em;text-transform:uppercase;padding:11px 20px;border:1.5px solid var(--ink);background:transparent;color:var(--ink);cursor:pointer;transition:all .22s;position:relative;overflow:hidden;}
.btn::after{content:'';position:absolute;inset:0;background:var(--ink);transform:translateY(100%);transition:transform .22s;z-index:-1;}
.btn:hover{color:var(--bg);}
.btn:hover::after{transform:translateY(0);}
.btn-primary{background:var(--ink);color:var(--bg);}
.btn-primary::after{background:var(--accent);}
.btn-primary:hover{color:#fff;}
.btn-upload{position:relative;}
.btn-upload input[type="file"]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.tracklist-wrap{width:100%;max-width:520px;margin-top:22px;opacity:0;transform:translateY(16px);transition:opacity .7s,transform .7s;}
.tracklist-wrap.visible{opacity:1;transform:translateY(0);}
.tracklist-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;border-bottom:1px solid #c4b49a;padding-bottom:10px;}
.tape-name-display{font-family:'Playfair Display',serif;font-size:1.1rem;font-style:italic;color:var(--ink);}
.side-badge{font-family:'Special Elite',cursive;font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:var(--muted);background:var(--paper);border:1px solid #c4b49a;padding:3px 8px;}
.track-item{display:flex;align-items:baseline;gap:12px;padding:9px 0;border-bottom:1px dashed #d5c5ae;cursor:pointer;}
.track-item:hover .track-title-gen{color:var(--accent);}
.track-num{font-family:'Special Elite',cursive;font-size:10px;color:var(--muted);min-width:18px;}
.track-info{flex:1;}
.track-title-gen{font-family:'Lora',serif;font-size:.9rem;color:var(--ink);transition:color .2s;}
.track-artist-gen{font-family:'Lora',serif;font-style:italic;font-size:.75rem;color:var(--muted);margin-top:1px;}
.track-dur{font-family:'Special Elite',cursive;font-size:10px;color:var(--muted);}
.divider{width:100%;max-width:520px;border:none;border-top:1px dashed #c4b49a;margin:8px 0 22px;}
.uploaded-note{font-family:'Lora',serif;font-style:italic;font-size:.8rem;color:var(--muted);text-align:center;margin-top:8px;min-height:16px;}
.loading-tape{text-align:center;padding:22px;font-family:'Special Elite',cursive;font-size:10px;letter-spacing:.3em;text-transform:uppercase;color:var(--muted);animation:pulse 1.2s infinite;}
footer{margin-top:50px;font-family:'Special Elite',cursive;font-size:9px;letter-spacing:.25em;text-transform:uppercase;color:var(--muted);opacity:.5;}
.mood-melancholy{--cassette-face:#6b8cae;--accent:#4a7fa5;--muted:#6b7f8c;}
.mood-joyful{--cassette-face:#f0c040;--accent:#d4a012;--muted:#a08040;}
.mood-romantic{--cassette-face:#d47fa0;--accent:#b05a7a;--muted:#8a5060;}
.mood-nostalgic{--cassette-face:#c47840;--accent:#a05828;--muted:#8a6040;}
.mood-dreamy{--cassette-face:#8a7fba;--accent:#6a5fa0;--muted:#6a5f80;}
.mood-calm{--cassette-face:#6aaa88;--accent:#4a8a6a;--muted:#507060;}
.mood-dark{--cassette-face:#3a3248;--accent:#6a5888;--muted:#504860;}

@media (max-width:640px){
  .cassette-scene{width:min(92vw,320px);}
  .tab-panel.active{grid-template-columns:1fr;}
  .palette-grid{grid-template-columns:repeat(4,1fr);}
}
</style>
</head>
<body>

<header>
  <p class="logo-line">üéµ Jigglypuff üéµ</p>
  <h1>Mood<br><em>Tape</em></h1>
  <p class="tagline">your feelings, pressed to magnetic ribbon</p>
</header>

<div class="cassette-scene">
  <div class="cassette-wrap" id="cassetteWrap">
    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 380'%3E%3Crect width='640' height='380' rx='24' fill='%23e6d5be'/%3E%3Crect x='30' y='40' width='580' height='240' rx='14' fill='%23cdbba4'/%3E%3Crect x='90' y='90' width='460' height='120' rx='8' fill='%23b29f84'/%3E%3Ccircle cx='210' cy='175' r='60' fill='%238b7a67'/%3E%3Ccircle cx='430' cy='175' r='60' fill='%238b7a67'/%3E%3Ccircle cx='210' cy='175' r='22' fill='%23d9cfbf'/%3E%3Ccircle cx='430' cy='175' r='22' fill='%23d9cfbf'/%3E%3Crect x='270' y='145' width='100' height='60' rx='8' fill='%23978367'/%3E%3Crect x='150' y='290' width='340' height='48' rx='8' fill='%23d9cfbf'/%3E%3C/svg%3E" class="cassette-svg" alt="Cassette tape">
    <div class="cassette-face-overlay" id="faceOverlay"></div>
    <div class="cassette-label-area"><div class="cassette-tape-title" id="cassetteLabelText">press play</div></div>
    <div class="reel-overlay reel-left-pos" id="reelLeft"><svg viewBox="0 0 60 60" fill="none"><circle cx="30" cy="30" r="22" stroke="rgba(255,255,255,.2)" stroke-width="2"/><circle cx="30" cy="30" r="9" fill="rgba(255,255,255,.13)"/><line x1="30" y1="8" x2="30" y2="18" stroke="rgba(255,255,255,.4)" stroke-width="2.5" stroke-linecap="round"/><line x1="49" y1="19" x2="40.4" y2="24" stroke="rgba(255,255,255,.4)" stroke-width="2.5" stroke-linecap="round"/><line x1="49" y1="41" x2="40.4" y2="36" stroke="rgba(255,255,255,.4)" stroke-width="2.5" stroke-linecap="round"/><line x1="30" y1="52" x2="30" y2="42" stroke="rgba(255,255,255,.4)" stroke-width="2.5" stroke-linecap="round"/><line x1="11" y1="41" x2="19.6" y2="36" stroke="rgba(255,255,255,.4)" stroke-width="2.5" stroke-linecap="round"/><line x1="11" y1="19" x2="19.6" y2="24" stroke="rgba(255,255,255,.4)" stroke-width="2.5" stroke-linecap="round"/></svg></div>
    <div class="reel-overlay reel-right-pos" id="reelRight"><svg viewBox="0 0 60 60" fill="none"><circle cx="30" cy="30" r="22" stroke="rgba(255,255,255,.2)" stroke-width="2"/><circle cx="30" cy="30" r="9" fill="rgba(255,255,255,.13)"/><line x1="30" y1="8" x2="30" y2="18" stroke="rgba(255,255,255,.4)" stroke-width="2.5" stroke-linecap="round"/><line x1="49" y1="19" x2="40.4" y2="24" stroke="rgba(255,255,255,.4)" stroke-width="2.5" stroke-linecap="round"/><line x1="49" y1="41" x2="40.4" y2="36" stroke="rgba(255,255,255,.4)" stroke-width="2.5" stroke-linecap="round"/><line x1="30" y1="52" x2="30" y2="42" stroke="rgba(255,255,255,.4)" stroke-width="2.5" stroke-linecap="round"/><line x1="11" y1="41" x2="19.6" y2="36" stroke="rgba(255,255,255,.4)" stroke-width="2.5" stroke-linecap="round"/><line x1="11" y1="19" x2="19.6" y2="24" stroke="rgba(255,255,255,.4)" stroke-width="2.5" stroke-linecap="round"/></svg></div>
    <div class="wave-bars" id="waveBars"><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div></div>
  </div>
</div>

<div class="player-section">
  <div class="now-playing" id="nowPlaying">‚Äî choose a track to play ‚Äî</div>
  <div class="progress-bar-wrap" id="progressWrap"><div class="progress-fill" id="progressFill"></div></div>
  <div class="play-controls">
    <button class="ctrl-btn" id="prevBtn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polygon points="19 20 9 12 19 4 19 20"/><line x1="5" y1="19" x2="5" y2="5"/></svg></button>
    <button class="ctrl-btn play-pause" id="playBtn"><svg id="playIcon" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg></button>
    <button class="ctrl-btn" id="nextBtn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polygon points="5 4 15 12 5 20 5 4"/><line x1="19" y1="5" x2="19" y2="19"/></svg></button>
  </div>
  <div class="volume-wrap"><span class="vol-icon">‚ô™</span><input type="range" class="vol-slider" id="volSlider" min="0" max="1" step="0.01" value="0.7"><span class="vol-icon">‚ô™‚ô™</span></div>
</div>

<div class="playlist-section">
  <span class="section-label">üéµ playlists üéµ</span>
  <div class="tab-bar">
    <button class="tab-btn active" data-tab="calm">üåø Calm</button>
    <button class="tab-btn" data-tab="bollywood">üé¨ Bollywood</button>
    <button class="tab-btn" data-tab="selena">üíú Selena</button>
    <button class="tab-btn" data-tab="halsey">üñ§ Halsey</button>
    <button class="tab-btn" data-tab="bieber">‚≠ê Bieber</button>
  </div>
  <div class="tab-panel active" id="tab-calm"></div>
  <div class="tab-panel" id="tab-bollywood"></div>
  <div class="tab-panel" id="tab-selena"></div>
  <div class="tab-panel" id="tab-halsey"></div>
  <div class="tab-panel" id="tab-bieber"></div>
</div>

<hr class="divider">

<div class="calm-section">
  <div class="calm-header"><span class="calm-icon">‚úø</span><div><div class="calm-title">Calm Advisor</div><div class="calm-subtitle">AI ¬∑ tell me how you feel</div></div></div>
  <div class="calm-input-row"><input type="text" class="calm-input" id="calmInput" placeholder="anxious, can't sleep, overwhelmed, heartbroken..."><button class="calm-btn" id="calmBtn">suggest ‚Üí</button></div>
  <div class="calm-response" id="calmResponse">Share how you're feeling and I'll suggest music &amp; gentle rituals to help you find stillness.</div>
  <div class="calm-tracks" id="calmTracks"></div>
</div>

<hr class="divider">

<div class="palette-section">
  <span class="section-label">‚ú¶ tape colour ‚ú¶</span>
  <div class="palette-grid" id="paletteGrid">
    <div class="palette-swatch active" data-face="#e8734a" data-accent="#c0392b" data-muted="#8b7355" data-bg="#f5efe6" data-ink="#2c1f0e"><div class="swatch-preview" style="--sw-face:#e8734a;--sw-accent:#c0392b;"></div><span class="swatch-name">Terra</span></div>
    <div class="palette-swatch" data-face="#3a3248" data-accent="#8b7fcc" data-muted="#9a8fc0" data-bg="#1e1a2e" data-ink="#e8e4f4"><div class="swatch-preview" style="--sw-face:#3a3248;--sw-accent:#8b7fcc;"></div><span class="swatch-name">Midnight</span></div>
    <div class="palette-swatch" data-face="#4a7a5a" data-accent="#2d5a3d" data-muted="#5a7060" data-bg="#f0f5f0" data-ink="#1a2e20"><div class="swatch-preview" style="--sw-face:#4a7a5a;--sw-accent:#2d5a3d;"></div><span class="swatch-name">Forest</span></div>
    <div class="palette-swatch" data-face="#d47fa0" data-accent="#a8476c" data-muted="#8a5a6a" data-bg="#fdf0f3" data-ink="#2e1020"><div class="swatch-preview" style="--sw-face:#d47fa0;--sw-accent:#a8476c;"></div><span class="swatch-name">Rose</span></div>
    <div class="palette-swatch" data-face="#d4a020" data-accent="#9a6e00" data-muted="#8a7040" data-bg="#fdf8ec" data-ink="#2a1e00"><div class="swatch-preview" style="--sw-face:#d4a020;--sw-accent:#9a6e00;"></div><span class="swatch-name">Golden</span></div>
    <div class="palette-swatch" data-face="#5a7fa0" data-accent="#2c5f82" data-muted="#607080" data-bg="#f0f4f8" data-ink="#0e1e2e"><div class="swatch-preview" style="--sw-face:#5a7fa0;--sw-accent:#2c5f82;"></div><span class="swatch-name">Steel</span></div>
    <div class="palette-swatch" data-face="#8a4a7a" data-accent="#5e2a56" data-muted="#7a5070" data-bg="#faf0f8" data-ink="#28102a"><div class="swatch-preview" style="--sw-face:#8a4a7a;--sw-accent:#5e2a56;"></div><span class="swatch-name">Plum</span></div>
    <div class="palette-swatch" data-face="#7fa080" data-accent="#4d7a58" data-muted="#608068" data-bg="#f4f8f4" data-ink="#142814"><div class="swatch-preview" style="--sw-face:#7fa080;--sw-accent:#4d7a58;"></div><span class="swatch-name">Sage</span></div>
    <div class="palette-swatch" data-face="#b84a2a" data-accent="#802010" data-muted="#805040" data-bg="#fdf2ee" data-ink="#2a0e08"><div class="swatch-preview" style="--sw-face:#b84a2a;--sw-accent:#802010;"></div><span class="swatch-name">Rust</span></div>
    <div class="palette-swatch" data-face="#2a2a2a" data-accent="#d0c8b8" data-muted="#999088" data-bg="#111111" data-ink="#ede8e0"><div class="swatch-preview" style="--sw-face:#2a2a2a;--sw-accent:#d0c8b8;"></div><span class="swatch-name">Onyx</span></div>
  </div>
</div>

<hr class="divider">

<div class="input-section">
  <label class="input-label" for="moodInput">‚ú¶ generate a mood tape</label>
  <input type="text" class="mood-input" id="moodInput" placeholder="rainy sunday, bittersweet, late night thoughts..." autocomplete="off">
  <p class="uploaded-note" id="uploadedNote"></p>
  <div class="actions">
    <button class="btn btn-primary" id="generateBtn">‚ú¶ make my tape</button>
    <label class="btn btn-upload">‚Üë import playlist<input type="file" id="playlistFile" accept=".txt,.csv,.m3u,.m3u8"></label>
    <button class="btn" id="clearBtn">clear</button>
  </div>
</div>
<div class="tracklist-wrap" id="tracklistWrap">
  <div class="tracklist-header"><span class="tape-name-display" id="tapeNameDisplay">‚Äî</span><span class="side-badge">üéµ Jigglypuff üéµ</span></div>
  <div id="trackItems"></div>
</div>

<footer>üéµ jigglypuff's mood tape ¬∑ mmxxv üéµ</footer>

<script>
let audioCtx = null;
let masterGain = null;
let isPlaying = false;
let progressInterval = null;
let trackStartTime = 0;
let trackDuration = 180;
let volumeLevel = 0.7;
let currentPlaylistKey = "calm";
let currentTrack = null;
let activeNodes = [];
let activeTimers = [];
let sectionCounter = 0;
let audioUnlocked = false;

const NOTE = {C3:130.81,D3:146.83,E3:164.81,F3:174.61,G3:196,A3:220,B3:246.94,C4:261.63,D4:293.66,E4:329.63,F4:349.23,G4:392,A4:440,B4:493.88,C5:523.25,D5:587.33,E5:659.25,F5:698.46,G5:783.99,A5:880};

const PLAYLISTS = {
  calm:[
    {id:"c0",emoji:"üåø",title:"Gymnop√©die No.1",artist:"Satie ¬∑ Synth",style:"calm",seed:11},
    {id:"c1",emoji:"üåô",title:"Clair de Lune",artist:"Debussy ¬∑ Synth",style:"calm",seed:17},
    {id:"c2",emoji:"üçÇ",title:"Nocturne Op.9 No.2",artist:"Chopin ¬∑ Synth",style:"calm",seed:23},
    {id:"c3",emoji:"üåä",title:"River Flows in You",artist:"Yiruma ¬∑ Synth",style:"dream",seed:29},
    {id:"c4",emoji:"‚ú®",title:"Dreamy Waltz",artist:"Original ¬∑ Synth",style:"dream",seed:31},
    {id:"c5",emoji:"üïØÔ∏è",title:"Meditative Bowls",artist:"Ambient ¬∑ Synth",style:"calm",seed:37},
    {id:"c6",emoji:"üéπ",title:"Experience",artist:"Einaudi ¬∑ Synth",style:"calm",seed:41},
    {id:"c7",emoji:"üå∏",title:"Lullaby in C",artist:"Original ¬∑ Synth",style:"dream",seed:43}
  ],
  bollywood:[
    {id:"b0",emoji:"üé¨",title:"Tum Hi Ho",artist:"Bollywood ¬∑ Synth",style:"bolly",seed:101},
    {id:"b1",emoji:"üí´",title:"Kesariya",artist:"Bollywood ¬∑ Synth",style:"bolly",seed:103},
    {id:"b2",emoji:"üåπ",title:"Raataan Lambiyan",artist:"Bollywood ¬∑ Synth",style:"bolly",seed:107},
    {id:"b3",emoji:"üéä",title:"Channa Mereya",artist:"Bollywood ¬∑ Synth",style:"bolly",seed:109},
    {id:"b4",emoji:"üåô",title:"Ik Vaari Aa",artist:"Bollywood ¬∑ Synth",style:"bolly",seed:113},
    {id:"b5",emoji:"üî•",title:"Besharam Rang",artist:"Bollywood ¬∑ Synth",style:"dance",seed:127},
    {id:"b6",emoji:"üéµ",title:"Teri Baaton Mein",artist:"Bollywood ¬∑ Synth",style:"bolly",seed:131},
    {id:"b7",emoji:"üíÉ",title:"Jhoome Jo Pathaan",artist:"Bollywood ¬∑ Synth",style:"dance",seed:137},
    {id:"b8",emoji:"üå∫",title:"Ae Dil Hai Mushkil",artist:"Bollywood ¬∑ Synth",style:"bolly",seed:139},
    {id:"b9",emoji:"üé∂",title:"Hawayein",artist:"Bollywood ¬∑ Synth",style:"bolly",seed:149}
  ],
  selena:[
    {id:"s0",emoji:"üíú",title:"Lose You to Love Me",artist:"Selena ¬∑ Synth",style:"dark",seed:201},
    {id:"s1",emoji:"üåô",title:"The Heart Wants What It Wants",artist:"Selena ¬∑ Synth",style:"dark",seed:211},
    {id:"s2",emoji:"üåπ",title:"Come & Get It",artist:"Selena ¬∑ Synth",style:"bolly",seed:223},
    {id:"s3",emoji:"üí´",title:"Same Old Love",artist:"Selena ¬∑ Synth",style:"pop",seed:227},
    {id:"s4",emoji:"ü¶ã",title:"Wolves",artist:"Selena ¬∑ Synth",style:"dark",seed:229},
    {id:"s5",emoji:"‚ú®",title:"Good for You",artist:"Selena ¬∑ Synth",style:"dark",seed:233},
    {id:"s6",emoji:"üé§",title:"Bad Liar",artist:"Selena ¬∑ Synth",style:"pop",seed:239},
    {id:"s7",emoji:"üíî",title:"Rare",artist:"Selena ¬∑ Synth",style:"pop",seed:241}
  ],
  halsey:[
    {id:"h0",emoji:"üñ§",title:"Without Me",artist:"Halsey ¬∑ Synth",style:"dark",seed:301},
    {id:"h1",emoji:"üåë",title:"Graveyard",artist:"Halsey ¬∑ Synth",style:"dark",seed:307},
    {id:"h2",emoji:"üé≠",title:"Colors",artist:"Halsey ¬∑ Synth",style:"dark",seed:311},
    {id:"h3",emoji:"üåä",title:"Gasoline",artist:"Halsey ¬∑ Synth",style:"dark",seed:313},
    {id:"h4",emoji:"üîÆ",title:"Eyes Closed",artist:"Halsey ¬∑ Synth",style:"dark",seed:317},
    {id:"h5",emoji:"üíô",title:"Closer",artist:"Chainsmokers ¬∑ Synth",style:"pop",seed:331},
    {id:"h6",emoji:"üåô",title:"Castle",artist:"Halsey ¬∑ Synth",style:"dark",seed:337},
    {id:"h7",emoji:"üí´",title:"Nightmare",artist:"Halsey ¬∑ Synth",style:"dark",seed:347}
  ],
  bieber:[
    {id:"jb0",emoji:"‚≠ê",title:"Love Yourself",artist:"Bieber ¬∑ Synth",style:"pop",seed:401},
    {id:"jb1",emoji:"üíõ",title:"Stay",artist:"Bieber ¬∑ Synth",style:"dance",seed:409},
    {id:"jb2",emoji:"‚òÄÔ∏è",title:"Peaches",artist:"Bieber ¬∑ Synth",style:"pop",seed:419},
    {id:"jb3",emoji:"üåä",title:"Intentions",artist:"Bieber ¬∑ Synth",style:"dance",seed:421},
    {id:"jb4",emoji:"üéµ",title:"Ghost",artist:"Bieber ¬∑ Synth",style:"pop",seed:431},
    {id:"jb5",emoji:"üíú",title:"Sorry",artist:"Bieber ¬∑ Synth",style:"dance",seed:433},
    {id:"jb6",emoji:"üåπ",title:"Anyone",artist:"Bieber ¬∑ Synth",style:"pop",seed:439},
    {id:"jb7",emoji:"‚ú®",title:"Baby",artist:"Bieber ¬∑ Synth",style:"dance",seed:443}
  ]
};

function getCtx(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    masterGain = audioCtx.createGain();
    masterGain.gain.value = volumeLevel;
    masterGain.connect(audioCtx.destination);
  }
  return audioCtx;
}

async function unlockAudio(){
  const ctx = getCtx();
  if(ctx.state === "suspended") await ctx.resume();
  const b = ctx.createBuffer(1,1,22050);
  const s = ctx.createBufferSource();
  s.buffer = b;
  s.connect(masterGain);
  s.start(0);
  audioUnlocked = true;
}

["click","touchstart","keydown"].forEach(evt=>{
  window.addEventListener(evt, ()=>{ if(!audioUnlocked){ unlockAudio().catch(()=>{}); } }, {once:true,passive:true});
});

function stopAll(){
  activeNodes.forEach(n=>{try{n.stop();}catch(_){}}); activeNodes=[];
  activeTimers.forEach(t=>clearTimeout(t)); activeTimers=[];
  clearInterval(progressInterval);
}

function rng(seed){let s=seed>>>0;return function(){s=(1664525*s+1013904223)>>>0;return s/4294967296;};}
function hashCode(str){let h=2166136261;for(let i=0;i<str.length;i++){h^=str.charCodeAt(i);h=Math.imul(h,16777619);}return h>>>0;}

function makeReverb(ctx,duration=2.2,decay=2.1){
  const c=ctx.createConvolver();const len=Math.floor(ctx.sampleRate*duration);const imp=ctx.createBuffer(2,len,ctx.sampleRate);
  for(let ch=0;ch<2;ch++){const d=imp.getChannelData(ch);for(let i=0;i<len;i++)d[i]=(Math.random()*2-1)*Math.pow(1-i/len,decay);}
  c.buffer=imp;return c;
}
function playTone(ctx,dest,freq,t,dur,wave,gain){
  if(!freq||!isFinite(freq)||freq<=0)return;
  const osc=ctx.createOscillator();const g=ctx.createGain();
  osc.type=wave;osc.frequency.setValueAtTime(freq,t);
  g.gain.setValueAtTime(0,t);g.gain.linearRampToValueAtTime(gain,t+0.02);g.gain.setValueAtTime(gain,t+Math.max(0.03,dur-0.05));g.gain.linearRampToValueAtTime(0,t+dur);
  osc.connect(g);g.connect(dest);osc.start(t);osc.stop(t+dur+0.01);activeNodes.push(osc);
}
function playKick(ctx,dest,t,vol){
  const osc=ctx.createOscillator();const g=ctx.createGain();
  osc.type="sine";osc.frequency.setValueAtTime(150,t);osc.frequency.exponentialRampToValueAtTime(50,t+0.11);
  g.gain.setValueAtTime(vol,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.13);
  osc.connect(g);g.connect(dest);osc.start(t);osc.stop(t+0.14);activeNodes.push(osc);
}
function playHat(ctx,dest,t,vol){
  const b=ctx.createBuffer(1,Math.floor(ctx.sampleRate*0.05),ctx.sampleRate);const data=b.getChannelData(0);for(let i=0;i<data.length;i++)data[i]=Math.random()*2-1;
  const src=ctx.createBufferSource();const hp=ctx.createBiquadFilter();const g=ctx.createGain();
  src.buffer=b;hp.type="highpass";hp.frequency.value=7000;g.gain.setValueAtTime(vol,t);g.gain.exponentialRampToValueAtTime(0.001,t+0.04);
  src.connect(hp);hp.connect(g);g.connect(dest);src.start(t);src.stop(t+0.05);
}
function profile(style){
  if(style==="calm")return{tempo:62,wave:"sine",pad:"triangle",drums:0.05,scale:[NOTE.A3,NOTE.C4,NOTE.D4,NOTE.E4,NOTE.G4,NOTE.A4,NOTE.C5,NOTE.D5,NOTE.E5],chords:[[NOTE.A3,NOTE.C4,NOTE.E4],[NOTE.F3,NOTE.A3,NOTE.C4],[NOTE.G3,NOTE.B3,NOTE.D4],[NOTE.E3,NOTE.G3,NOTE.B3]]};
  if(style==="dream")return{tempo:68,wave:"sine",pad:"sine",drums:0.08,scale:[NOTE.C4,NOTE.D4,NOTE.E4,NOTE.G4,NOTE.A4,NOTE.C5,NOTE.D5,NOTE.E5],chords:[[NOTE.C4,NOTE.E4,NOTE.G4],[NOTE.A3,NOTE.C4,NOTE.E4],[NOTE.F3,NOTE.A3,NOTE.C4],[NOTE.G3,NOTE.B3,NOTE.D4]]};
  if(style==="bolly")return{tempo:94,wave:"sine",pad:"triangle",drums:0.55,scale:[NOTE.A3,NOTE.B3,NOTE.C4,NOTE.D4,NOTE.E4,NOTE.F4,NOTE.G4,NOTE.A4,NOTE.C5,NOTE.D5,NOTE.E5],chords:[[NOTE.A3,NOTE.C4,NOTE.E4],[NOTE.D3,NOTE.F3,NOTE.A3],[NOTE.E3,NOTE.G3,NOTE.B3],[NOTE.F3,NOTE.A3,NOTE.C4]]};
  if(style==="dance")return{tempo:112,wave:"square",pad:"triangle",drums:0.95,scale:[NOTE.A3,NOTE.C4,NOTE.D4,NOTE.E4,NOTE.G4,NOTE.A4,NOTE.C5,NOTE.D5,NOTE.E5],chords:[[NOTE.A3,NOTE.C4,NOTE.E4],[NOTE.G3,NOTE.B3,NOTE.D4],[NOTE.F3,NOTE.A3,NOTE.C4],[NOTE.E3,NOTE.G3,NOTE.B3]]};
  if(style==="dark")return{tempo:82,wave:"triangle",pad:"sine",drums:0.45,scale:[NOTE.A3,NOTE.C4,NOTE.D4,NOTE.E4,NOTE.F4,NOTE.G4,NOTE.A4,NOTE.C5,NOTE.D5],chords:[[NOTE.A3,NOTE.C4,NOTE.E4],[NOTE.F3,NOTE.A3,NOTE.C4],[NOTE.D3,NOTE.F3,NOTE.A3],[NOTE.G3,NOTE.B3,NOTE.D4]]};
  return{tempo:96,wave:"sine",pad:"triangle",drums:0.7,scale:[NOTE.G3,NOTE.A3,NOTE.B3,NOTE.C4,NOTE.D4,NOTE.E4,NOTE.G4,NOTE.A4,NOTE.B4,NOTE.C5,NOTE.D5],chords:[[NOTE.G3,NOTE.B3,NOTE.D4],[NOTE.C3,NOTE.E3,NOTE.G3],[NOTE.A3,NOTE.C4,NOTE.E4],[NOTE.D3,NOTE.F3,NOTE.A3]]};
}
function composeSection(track){
  const ctx=getCtx();const p=profile(track.style);const beat=60/p.tempo;const bars=8;const start=ctx.currentTime+0.03;const r=rng(track.seed+sectionCounter++);
  const rev=makeReverb(ctx,track.style==="calm"?3.2:2.2,2.2);rev.connect(masterGain);
  let t=start;
  for(let b=0;b<bars;b++){
    const chord=p.chords[(b+Math.floor(r()*p.chords.length))%p.chords.length];
    chord.forEach((f,i)=>playTone(ctx,rev,i===2?f*2:f,t,beat*3.9,p.pad,0.028+r()*0.012));
    for(let i=0;i<4;i++){
      const n=p.scale[Math.floor(r()*p.scale.length)];
      const dur=(r()>0.75?0.75:0.5)*beat;
      playTone(ctx,rev,n,t+i*beat,dur,p.wave,0.09+r()*0.04);
      if(r()>0.72)playTone(ctx,rev,n*2,t+i*beat+dur,Math.min(dur,beat*0.35),p.wave,0.05);
    }
    if(p.drums>0){
      playKick(ctx,masterGain,t,0.14*p.drums);
      if(p.drums>0.7)playKick(ctx,masterGain,t+2*beat,0.09*p.drums);
      playHat(ctx,masterGain,t+beat,0.03*p.drums);
      playHat(ctx,masterGain,t+3*beat,0.03*p.drums);
    }
    t+=4*beat;
  }
  return bars*4*beat*1000;
}

function updatePlayState(playing){
  isPlaying=playing;
  const icon=document.getElementById("playIcon");
  icon.innerHTML=playing?'<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>':'<polygon points="5 3 19 12 5 21 5 3"/>';
  document.getElementById("cassetteWrap").classList.toggle("playing",playing);
  document.getElementById("reelLeft").classList.toggle("spinning",playing);
  document.getElementById("reelRight").classList.toggle("spinning",playing);
  document.getElementById("waveBars").classList.toggle("visible",playing);
  document.getElementById("waveBars").classList.toggle("active",playing);
}
function startTrack(track){
  const ctx=getCtx();if(ctx.state==="suspended")ctx.resume();
  stopAll();updatePlayState(true);sectionCounter=0;
  const loop=()=>{if(!isPlaying)return;const ms=composeSection(track);const timer=setTimeout(loop,Math.max(2000,ms-120));activeTimers.push(timer);};
  loop();
  trackStartTime=Date.now();trackDuration=180;
  clearInterval(progressInterval);
  progressInterval=setInterval(()=>{const elapsed=(Date.now()-trackStartTime)/1000;const pct=Math.min((elapsed/trackDuration)*100,100);document.getElementById("progressFill").style.width=pct+"%";if(elapsed>=trackDuration)trackStartTime=Date.now();},300);
}
function setTrack(t,autoplay=false){
  currentTrack=t;
  document.getElementById("cassetteLabelText").textContent=t.title;
  document.getElementById("cassetteLabelText").classList.add("visible");
  document.getElementById("nowPlaying").innerHTML=`<em>${t.title}</em> ‚Äî ${t.artist}`;
  document.getElementById("progressFill").style.width="0%";
  document.querySelectorAll(".playlist-track").forEach(el=>el.classList.toggle("active",el.dataset.trackId===t.id));
  stopAll();updatePlayState(false);
  if(autoplay)startTrack(t);
}
function buildPanel(key){
  const panel=document.getElementById("tab-"+key);panel.innerHTML="";
  PLAYLISTS[key].forEach(t=>{
    const el=document.createElement("div");
    el.className="playlist-track";el.dataset.trackId=t.id;
    el.innerHTML=`<span class="track-emoji">${t.emoji}</span><div class="track-meta"><div class="track-meta-title">${t.title}</div><div class="track-meta-artist">${t.artist}</div></div>`;
    el.addEventListener("click",async()=>{await unlockAudio();setTrack(t,true);});
    panel.appendChild(el);
  });
}
Object.keys(PLAYLISTS).forEach(buildPanel);

document.querySelectorAll(".tab-btn").forEach(btn=>btn.addEventListener("click",()=>{document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));document.querySelectorAll(".tab-panel").forEach(p=>p.classList.remove("active"));btn.classList.add("active");currentPlaylistKey=btn.dataset.tab;document.getElementById("tab-"+btn.dataset.tab).classList.add("active");}));

document.getElementById("playBtn").addEventListener("click",async()=>{try{await unlockAudio();if(isPlaying){stopAll();updatePlayState(false);}else{startTrack(currentTrack||PLAYLISTS.calm[0]);}}catch(e){console.error(e);}});
document.getElementById("nextBtn").addEventListener("click",async()=>{await unlockAudio();const list=PLAYLISTS[currentPlaylistKey];const idx=list.findIndex(t=>currentTrack&&t.id===currentTrack.id);setTrack(list[(idx+1+list.length)%list.length],isPlaying);});
document.getElementById("prevBtn").addEventListener("click",async()=>{await unlockAudio();const list=PLAYLISTS[currentPlaylistKey];const idx=list.findIndex(t=>currentTrack&&t.id===currentTrack.id);setTrack(list[(idx-1+list.length)%list.length],isPlaying);});
document.getElementById("volSlider").addEventListener("input",e=>{volumeLevel=+e.target.value;if(masterGain)masterGain.gain.value=volumeLevel;});
document.getElementById("progressWrap").addEventListener("click",e=>{const r=e.currentTarget.getBoundingClientRect();trackStartTime=Date.now()-((e.clientX-r.left)/r.width)*trackDuration*1000;});


const calmRules=[{k:/anxious|panic|overwhelm|stress/i,m:"You are carrying too much at once. Let the sound slow your breathing.",r:["Inhale 4, exhale 6 for 2 minutes.","Relax your jaw and shoulders.","Sip warm water slowly."],rec:[5,0,1]},{k:/heart|break|sad|cry|miss/i,m:"Your heart needs gentleness, not pressure. Let this tape hold the heavy part.",r:["Hand on heart for 60 seconds.","Write one line and release it.","Take a short slow walk."],rec:[2,4,7]},{k:/sleep|insomnia|night/i,m:"Night will soften if you let it be quiet. We will slow the mind first.",r:["No bright screen for 15 minutes.","Long exhales before bed.","Keep volume low and steady."],rec:[1,5,7]}];
function localCalm(feeling){const m=calmRules.find(x=>x.k.test(feeling));return m||{m:"Thanks for sharing. Let‚Äôs settle your mood with warm, steady sound.",r:["Breathe slowly for 1 minute.","Drink water.","Sit still with one track."],rec:[0,3,6]};}
function askCalm(){
  const feeling=document.getElementById("calmInput").value.trim();if(!feeling)return;
  const resp=document.getElementById("calmResponse");const pills=document.getElementById("calmTracks");
  resp.className="calm-response loading";resp.textContent="reading your energy...";pills.innerHTML="";
  setTimeout(()=>{const out=localCalm(feeling);resp.className="calm-response";resp.innerHTML=out.m+"<br><br>"+out.r.map(x=>"‚ú¶ "+x).join("<br>");
    out.rec.forEach(idx=>{const t=PLAYLISTS.calm[idx];if(!t)return;const pill=document.createElement("button");pill.className="calm-track-pill";pill.textContent=t.emoji+" "+t.title;
      pill.addEventListener("click",async()=>{await unlockAudio();document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));document.querySelectorAll(".tab-panel").forEach(p=>p.classList.remove("active"));document.querySelector('[data-tab="calm"]').classList.add("active");document.getElementById("tab-calm").classList.add("active");currentPlaylistKey="calm";setTrack(t,true);});
      pills.appendChild(pill);
    });
  },350);
}
document.getElementById("calmBtn").addEventListener("click",askCalm);
document.getElementById("calmInput").addEventListener("keydown",e=>{if(e.key==="Enter")askCalm();});


document.getElementById("paletteGrid").addEventListener("click",e=>{
  const sw=e.target.closest(".palette-swatch");if(!sw)return;
  document.querySelectorAll(".palette-swatch").forEach(s=>s.classList.remove("active"));
  sw.classList.add("active");
  const {face,accent,muted,bg,ink}=sw.dataset;
  document.body.style.setProperty("--cassette-face",face);
  document.body.style.setProperty("--accent",accent);
  document.body.style.setProperty("--muted",muted);
  document.body.style.setProperty("--bg",bg);
  document.body.style.setProperty("--ink",ink);
  document.body.style.setProperty("--paper",bg==="#111111"?"#1e1e1e":bg);
  document.body.style.backgroundColor=bg;
  document.getElementById("faceOverlay").style.background=face;
});


const moodMap={sad:"mood-melancholy",blue:"mood-melancholy",lonely:"mood-melancholy",rainy:"mood-melancholy",happy:"mood-joyful",joyful:"mood-joyful",love:"mood-romantic",romantic:"mood-romantic",nostalgic:"mood-nostalgic",dreamy:"mood-dreamy",calm:"mood-calm",peaceful:"mood-calm",dark:"mood-dark",midnight:"mood-dark"};
const moodClasses=["mood-melancholy","mood-joyful","mood-romantic","mood-nostalgic","mood-dreamy","mood-calm","mood-dark"];
function detectMood(t){const l=t.toLowerCase();for(const [k,v] of Object.entries(moodMap))if(l.includes(k))return v;return "mood-nostalgic";}
document.getElementById("moodInput").addEventListener("input",e=>{if(e.target.value.length>2){document.body.classList.remove(...moodClasses);document.body.classList.add(detectMood(e.target.value));}});


const HOLLYWOOD_BANK=["Blinding Lights","Levitating","As It Was","Stay","Peaches","Ghost","Perfect","Someone Like You","Bad Guy","Flowers","Shape of You","Happier","Memories","Sunflower","Dusk Till Dawn","Youngblood"];
const BOLLYWOOD_BANK=["Tum Hi Ho","Kesariya","Raataan Lambiyan","Channa Mereya","Ik Vaari Aa","Besharam Rang","Hawayein","Agar Tum Saath Ho","Kalank","Shayad","Apna Bana Le","Tera Ban Jaunga","Kabira","Ilahi","Ranjha","Jeene Laga Hoon"];
function pickTracks(moodText,imported){
  if(imported&&imported.length)return imported.slice(0,8).map((x,i)=>({title:x,artist:i%2?"Imported Artist":"Imported Mix",duration:`${2+(i%3)}:${String((i*19)%60).padStart(2,"0")}`}));
  const seed=hashCode((moodText||"mood").toLowerCase());const r=rng(seed);const pool=[...HOLLYWOOD_BANK,...BOLLYWOOD_BANK];const used=new Set();const out=[];
  while(out.length<7){const t=pool[Math.floor(r()*pool.length)];if(used.has(t))continue;used.add(t);out.push({title:t,artist:HOLLYWOOD_BANK.includes(t)?"Hollywood Mix":"Bollywood Mix",duration:`${2+Math.floor(r()*3)}:${String(Math.floor(r()*60)).padStart(2,"0")}`});}
  return out;
}
function tapeName(moodText){return (moodText||"Mood Tape").trim().split(/\s+/).slice(0,4).join(" ").replace(/\b\w/g,c=>c.toUpperCase());}
function generateTape(moodText,imported=null){
  const btn=document.getElementById("generateBtn");btn.textContent="‚ü≥ reading the vibe...";btn.disabled=true;
  document.body.classList.remove(...moodClasses);document.body.classList.add(detectMood(moodText));
  const tw=document.getElementById("tracklistWrap");tw.classList.add("visible");
  document.getElementById("trackItems").innerHTML='<div class="loading-tape">pressing your tape...</div>';
  setTimeout(()=>{const tracks=pickTracks(moodText,imported);const name=tapeName(moodText);
    document.getElementById("tapeNameDisplay").textContent=name;
    document.getElementById("cassetteLabelText").textContent=name;
    document.getElementById("cassetteLabelText").classList.add("visible");
    const items=document.getElementById("trackItems");items.innerHTML="";
    tracks.forEach((t,i)=>{const d=document.createElement("div");d.className="track-item";d.innerHTML=`<span class="track-num">${String(i+1).padStart(2,"0")}</span><div class="track-info"><div class="track-title-gen">${t.title}</div><div class="track-artist-gen">${t.artist}</div></div><span class="track-dur">${t.duration}</span>`;items.appendChild(d);});
    btn.textContent="‚ú¶ make my tape";btn.disabled=false;
  },450);
}
document.getElementById("generateBtn").addEventListener("click",()=>{const m=document.getElementById("moodInput").value.trim();if(m)generateTape(m);});
document.getElementById("moodInput").addEventListener("keydown",e=>{if(e.key==="Enter")document.getElementById("generateBtn").click();});
document.getElementById("clearBtn").addEventListener("click",()=>{document.getElementById("moodInput").value="";document.getElementById("tracklistWrap").classList.remove("visible");document.getElementById("uploadedNote").textContent="";document.body.classList.remove(...moodClasses);});
document.getElementById("playlistFile").addEventListener("change",e=>{
  const file=e.target.files[0];if(!file)return;
  const reader=new FileReader();
  reader.onload=ev=>{
    const raw=String(ev.target.result||"");
    const lines=raw.split("\n").map(l=>l.trim()).filter(l=>l&&!l.startsWith("#")&&!/^https?:\/\//i.test(l));
    const ext=raw.split("\n").filter(l=>l.startsWith("#EXTINF")).map(l=>l.split(",").slice(1).join(",").trim()).filter(Boolean);
    const tracks=[...ext,...lines].filter(Boolean).slice(0,20);
    if(tracks.length){document.getElementById("uploadedNote").textContent=`‚Üë ${tracks.length} tracks from "${file.name}"`;generateTape(document.getElementById("moodInput").value||"nostalgic",tracks);}
  };
  reader.readAsText(file);
});

document.getElementById("volSlider").value="0.7";
setTrack(PLAYLISTS.calm[0],false);
</script>
</body>
</html>
